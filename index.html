
<!-- templates/index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>File Organizer Upload</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial; padding: 24px; max-width: 900px; margin: auto; }
    .drop { border: 2px dashed #888; padding: 40px; text-align: center; border-radius: 8px; cursor: pointer; }
    .drop.dragover { border-color: #2a9df4; background: #f3fbff; }
    .files { margin-top: 16px; }
    .btn { margin-top: 12px; padding: 8px 14px; border-radius: 6px; cursor: pointer; }
    .info { margin-top: 12px; }
    pre { background: #f5f5f5; padding: 12px; border-radius: 6px; overflow:auto; }
  </style>
</head>
<body>
  <h2>File Organizer â€” Upload files</h2>

  <div id="dropZone" class="drop">
    Drag & drop files here, or <input id="fileInput" type="file" multiple style="display:inline-block; margin-left:8px;">
  </div>

  <div class="files" id="fileList"></div>

  <button id="uploadBtn" class="btn">Upload selected</button>

  <div class="info" id="result"></div>

  <script>
    const drop = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const fileListEl = document.getElementById('fileList');
    const uploadBtn = document.getElementById('uploadBtn');
    const resultEl = document.getElementById('result');
    let files = [];

    function renderFiles() {
      if (!files.length) {
        fileListEl.innerHTML = "<em>No files selected</em>";
        return;
      }
      fileListEl.innerHTML = "<ul>" + files.map((f, i) =>
        `<li>${f.name} (${Math.round(f.size/1024)} KB) <button data-i="${i}">Remove</button></li>`).join('') + "</ul>";
      fileListEl.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', e => {
          const idx = +btn.getAttribute('data-i');
          files.splice(idx, 1);
          renderFiles();
        });
      });
    }

    drop.addEventListener('dragover', (e) => {
      e.preventDefault();
      drop.classList.add('dragover');
    });

    drop.addEventListener('dragleave', (e) => {
      drop.classList.remove('dragover');
    });

    drop.addEventListener('drop', (e) => {
      e.preventDefault();
      drop.classList.remove('dragover');
      const dropped = Array.from(e.dataTransfer.files);
      files = files.concat(dropped);
      renderFiles();
    });

    fileInput.addEventListener('change', (e) => {
      const picked = Array.from(e.target.files);
      files = files.concat(picked);
      renderFiles();
    });

    uploadBtn.addEventListener('click', async () => {
      if (!files.length) {
        alert("Pick some files first.");
        return;
      }
      const form = new FormData();
      files.forEach(f => form.append('files', f));

      uploadBtn.disabled = true;
      resultEl.innerHTML = "Uploading...";

      try {
        const res = await fetch('/upload', { method: 'POST', body: form });
        const data = await res.json();
        if (data.success) {
          resultEl.innerHTML = `<strong>Uploaded:</strong><pre>${JSON.stringify(data.saved, null, 2)}</pre>`;
          files = [];
          renderFiles();
        } else {
          resultEl.innerHTML = `<strong>Error:</strong> ${data.message || 'Upload failed'}`;
        }
      } catch (err) {
        resultEl.innerHTML = `<strong>Upload error:</strong> ${err}`;
      } finally {
        uploadBtn.disabled = false;
      }
    });

    // initial render
    renderFiles();
  </script>
</body>
</html>
